---
title: HTTP 协议各个版本演进
typora-root-url: HTTP 协议各个版本演进
date: 2025-12-03 22:45:54
tags: [HTTP, 网络, 协议]
---

## 总览

| 特性           | HTTP/1.0         | HTTP/1.1                 | HTTP/2                     | HTTP/3                    |
| -------------- | ---------------- | ------------------------ | -------------------------- | ------------------------- |
| **连接方式**   | 短连接           | 默认长连接（keep-alive） | 单连接多路复用             | 基于 QUIC（UDP）多路复用  |
| **队头阻塞**   | 有（TCP + HTTP） | 有（TCP 队头阻塞）       | 减轻但仍有（TCP HOL）      | 无（基于流的独立传输）    |
| **多路复用**   | ❌               | ❌（需多个 TCP）         | ✅（帧级别多路复用）       | ✅（天然支持）            |
| **二进制协议** | ❌ 文本传输      | ❌ 文本传输              | ✅ 完全二进制              | ✅ 完全二进制             |
| **TLS 握手**   | 可选（慢）       | 可选（慢）               | TLS1.2/1.3（仍需 TCP+TLS） | TLS1.3 内建在 QUIC，0-RTT |
| **服务端推送** | ❌               | ❌                       | 支持                       | HTTP/3 中已废弃           |
| **头部压缩**   | ❌               | ❌                       | HPACK 压缩                 | QPACK 压缩（防队头阻塞）  |

## HTTP/1.0 —— 最早期，功能很有限

### 特点

- **每个请求都要重新建立 TCP 链接（短连接）**
- 不支持 Host 头，一台服务器无法托管多个网站
- 响应没有缓存控制（没有 Cache-Control）

### 缺点

- 建立 TCP（3 次握手） + 可能 TLS，每个请求都很慢
- 队头阻塞严重：一个连接一次只能处理一个请求
- 无法应对现代网站大量静态资源

## HTTP/1.1 —— 最重要的一代，通行至今

### 关键提升

- **默认开启 keep-alive，支持连接复用**
  → 避免重复握手，但一个连接仍然需要顺序处理。
- 引入 **Host** 头
  → 一个 IP 托管多个域名成为可能
- 引入缓存字段：`Cache-Control`、`ETag`、`If-Modified-Since`
- 分块传输（chunked）

### 仍然存在队头阻塞（HTTP 队头阻塞）

同一个 TCP 连接中：

1. 请求必须按顺序发送
2. 响应也必须按顺序返回
   → 若第一个响应慢，后面的请求必须等待

要提高并发，只能开更多 TCP 连接（浏览器通常限制 6 个）。

## HTTP/2 —— 多路复用时代

### 核心改进

- **二进制协议**
- **帧（Frame）机制**
- **单 TCP 连接上多路复用**
- 头部压缩（HPACK）
- 优先级、服务器推送

### 但仍然存在 _TCP 队头阻塞_

虽然 HTTP 层不用排队了，但 TCP 是字节流：

- 即使有多个 Stream，多条流的帧是混合发送的
- **任何一个 packet（TCP 层）丢失都会阻塞整个连接**
- 整个 HTTP/2 的流都要等待该 packet 重传
  → 这就是 HTTP/2 的最大局限

在移动网络特别明显，高延迟 + 丢包 → 性能反而下降。

## HTTP/3 —— 彻底消灭队头阻塞（基于 QUIC 的 HTTP）

HTTP/3 = HTTP/2 的语义 + QUIC（UDP） + QPACK

### 最重要的特性：**传输层无队头阻塞**

QUIC（基于 UDP + TLS1.3）特性：

- **每个 Stream 都是独立可靠的传输通道**
- 一个流丢包不会阻塞其他流
  → 真正意义上的多路复用

### 其他优势

- 0-RTT / 1-RTT 建连
  → 极快的握手速度
- 内建 TLS，不依赖 TCP 层
- 改进头部压缩（QPACK）避免 HPACK 的阻塞问题

### 难点

- 部署需要支持 QUIC，不是所有 CDN / 服务端都完整支持
- UDP NAT 穿透复杂
- 对负载均衡有要求

## 队头阻塞问题总结

| 协议     | 队头阻塞来源    | 解决情况             |
| -------- | --------------- | -------------------- |
| HTTP/1.1 | HTTP 层串行请求 | 未解决               |
| HTTP/2   | TCP 层丢包导致  | 部分缓解，未完全解决 |
| HTTP/3   | 无（独立流）    | ✔ 完全解决           |

总结：

> **HTTP/2 解决了 HTTP 层的队头阻塞，但无法解决 TCP 层的队头阻塞。
> HTTP/3 改用 QUIC，从传输层消灭队头阻塞。**

## 重点记忆

- **HTTP/1.1 → 默认 keep-alive，提升性能；但队头阻塞仍严重**
- **HTTP/2 → 二进制帧、多路复用、HPACK；但 TCP 队头阻塞仍存在**
- **HTTP/3 → 基于 QUIC 的多路复用；彻底解决队头阻塞**
- 协议发展方向：减少握手消耗、增加并发能力、减少阻塞
